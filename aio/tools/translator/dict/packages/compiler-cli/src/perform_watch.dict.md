The logic in this function is adapted from `tsc.ts` from TypeScript.

此函数中的逻辑改编自 TypeScript 的 `tsc.ts`