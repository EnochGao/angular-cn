# Work with translation files

# 处理翻译文件

{@a ng-xi18n}
{@a ng-xi18n-options}
{@a translate}

After preparing a template for translation, use the [`extract-i18n`][AioCliExtractI18n] Angular CLI command to extract the marked text in the template into a *source language* file.

准备好翻译模板后，使用 Angular CLI 命令 [`extract-i18n`][AioCliExtractI18n] 将模板中已标记的文本提取到*源语言*文件中。

The marked text includes text marked with `i18n` and attributes marked with `i18n-`*attribute* as described in the previous section.
Follow these steps:

已标记文本包括标记为 `i18n` 的文本和标记为 `i18n-`*属性*的属性，如上一节所述。步骤如下：

1. [Extract the source language file][AioGuideI18nCommonTranslationFilesExtractTheSourceLanguageFile].
   Optionally, change the location, format, and name.

   [提取源语言文件][AioGuideI18nCommonTranslationFilesExtractTheSourceLanguageFile]。（可选）更改位置、格式和名称。

1. [Create a translation file for each language][AioGuideI18nCommonTranslationFilesCreateATranslationFileForEachLanguage] by copying the source language file.

   通过复制源语言文件 [为每种语言创建一个翻译文件][AioGuideI18nCommonTranslationFilesCreateATranslationFileForEachLanguage]。

1. [Translate each translation file][AioGuideI18nCommonTranslationFilesTranslateEachTranslationFile].

   [翻译每个翻译文件][AioGuideI18nCommonTranslationFilesTranslateEachTranslationFile]。

1. [Translate plurals and alternate expressions][AioGuideI18nCommonTranslationFilesTranslatePluralsAndAlternateExpressions] separately.

   分别[翻译复数和替代表达式][AioGuideI18nCommonTranslationFilesTranslatePluralsAndAlternateExpressions]。

### Extract the source language file

### 提取源语言文件

{@a create-source}

To extract the source language file, open a terminal window, change to the root directory of your application project, and run the following CLI command:

要提取源语言文件，请打开终端窗口，切换到应用程序项目的根目录，然后运行以下 CLI 命令：

<code-example path="i18n/doc-files/commands.sh" region="extract-i18n-default" language="sh"></code-example>

The `extract-i18n` command creates a source language file named `messages.xlf` in the root directory of your project using the [XML Localization Interchange File Format (XLIFF, version 1.2)][WikipediaWikiXliff].

`extract-i18n` 命令使用 [XML 本地化语言交换格式 (XLIFF, 版本 1.2)][WikipediaWikiXliff] 在项目的根目录中创建一个名为 `messages.xlf` 的源语言文件。

Use the following [`extract-i18n` command options][AioCliExtractI18n] to change the source language file location, format, and file name:

可以用下列 [`extract-i18n` 命令选项][AioCliExtractI18n]来更改源语言文件位置、格式和文件名：

* `--output-path`: Change the location.

  `--output-path` ：更改位置。

* `--format`: Change the format.

  `--format` ：更改格式。

* `--outFile`: Change the file name.

  `--outFile` ：更改文件名。

<div class="alert is-helpful">

**Note**: The `--i18n-locale` option is deprecated.
Angular 9 uses the source locale configured in the [workspace configuration][AioGuideWorkspaceConfig] file (`angular.json`) of your application.

**注意**：不推荐使用 `--i18n-locale` 选项。 Angular 9 使用在应用程序的 [workspace configuration][AioGuideWorkspaceConfig] 文件 ( `angular.json` ) 中配置的源语言环境。

</div>

#### Change the source language file location

#### 更改源语言文件位置

To create a file in the `src/locale` directory, specify the output path as an option.
The following example specifies the output path as an option.

要在 `src/locale` 目录中创建文件，请在选项中指定输出路径。以下示例就在选项中指定了输出路径。

<code-example path="i18n/doc-files/commands.sh" region="extract-i18n-output-path" language="sh"></code-example>

#### Change the source language file format

#### 更改源语言文件格式

{@a other-formats}

The `extract-i18n` command writes files in the following translation formats.

`extract-i18n` 命令以下列转换格式写入文件。

* XLIFF 1.2 (default)

  XLIFF 1.2（默认）

* XLIFF 2
* [XML Message Bundle (XMB)][UnicodeCldrDevelopmentDevelopmentProcessDesignProposalsXmb]

  [XML 消息包 (XMB)][UnicodeCldrDevelopmentDevelopmentProcessDesignProposalsXmb]

* JSON
* [ARB][GithubGoogleAppResourceBundleWikiApplicationresourcebundlespecification]

  [ARB][GithubGoogleAppResourceBundleWikiApplicationresourcebundle 规范]

Specify the translation format explicitly with the `--format` command option.
The following example demonstrates several translation formats.

使用 `--format` 命令选项明确指定转换格式。以下示例演示了几种翻译格式。

<code-example path="i18n/doc-files/commands.sh" region="extract-i18n-formats" language="sh"></code-example>

<div class="alert is-helpful">

XLIFF files use the extension `.xlf`.
The XMB format generates `.xmb` source language files but uses`.xtb` (XML Translation Bundle or XTB) translation files.

XLIFF 文件使用扩展名 `.xlf`。 XMB 格式会生成 `.xmb` 源语言文件，但会使用 `.xtb`（XML Translation Bundle 或 XTB）格式的翻译文件。

</div>

#### Change the source language file name

#### 更改源语言文件名

To change the name of the source language file generated by the extraction tool, use
the `--outFile` command option:

要更改提取工具生成的源语言文件的名称，请使用 `--outFile` 命令选项：

<code-example path="i18n/doc-files/commands.sh" region="extract-i18n-out-file" language="sh"></code-example>

### Create a translation file for each language

### 为每种语言创建一个翻译文件

{@a localization-folder}

The `ng extract-i18n` command (with no options) generates a source language file named `messages.xlf` in the project `src` folder.
Create *translation* files for each language by copying the source language file.
To avoid confusion with multiple translations, you should organize the language translation files by locale in a dedicated `locale` folder under `src/`.
Use a filename extension that matches the associated locale, such as `messages.fr.xlf`.

`ng extract-i18n` 命令（不带选项）在项目的 `src` 文件夹中生成一个名为 `messages.xlf` 的源语言文件。通过复制源语言文件来为每种语言创建相应的*翻译*文件。为避免让多个翻译相互混淆，你应该在 `src/` 下的 `locale` 专属文件夹中按语言环境来组织语言翻译文件。使用与相关语言环境匹配的文件扩展名，例如 `messages.fr.xlf` 。

For example, to create a French translation file, follow these steps:

例如，要创建法语翻译文件，请执行以下步骤：

1. Make a copy of the `messages.xlf` source language file.

   制作 `messages.xlf` 源语言文件的副本。

1. Put the copy in the `src/locale` folder.

   将副本放在 `src/locale` 文件夹中。

1. Rename the copy to `messages.fr.xlf` for the French language (`fr`) translation.
   Send this translation file to the translator.

   将副本重命名为 `messages.fr.xlf` 以进行法语 ( `fr` ) 翻译。将此翻译文件发送给翻译人员。

Repeat the above steps for each language you want to add to your application.

对要添加到应用程序中的每种语言重复上述步骤。

### Translate each translation file

### 翻译每个翻译文件

{@a translate-text-nodes}

Unless you are fluent in the language and have the time to edit translations, you would likely send each translation file to a translator, who would then use an XLIFF file editor to create and edit the translation.

除非你精通该语言并且有时间编辑这些翻译文件，否则你可能会将每个翻译文件发送给翻译人员，他们会使用 XLIFF 文件编辑器来创建和编辑这个翻译文件。

To demonstrate this process, review the `messages.fr.xlf` file in the <live-example></live-example>.  The live example includes a French translation for you to edit without a special XLIFF editor or knowledge of French.
Complete the following actions.

要演示此过程，请查看<live-example></live-example>中的 `messages.fr.xlf` 文件。现场示例包括法语翻译，你无需特殊的 XLIFF 编辑器或法语知识即可进行编辑。完成以下操作。

1. Open `messages.fr.xlf` and find the first `<trans-unit>` element.
   This is a *translation unit*, also known as a *text node*, representing the translation of the `<h1>` greeting tag that was previously marked with the `i18n` attribute:

   打开 `messages.fr.xlf` 并找到第一个 `<trans-unit>` 元素。这是一个*翻译单元*，也称为*文本节点*，表示之前用 `i18n` 属性标记的 `<h1>` 问候语标签的翻译：

   > <code-example path="i18n/doc-files/messages.fr.xlf.html" region="translated-hello-before" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>
   >
   > The `id="introductionHeader"` is a [custom ID][AioGuideI18nOptionalManageMarkedText], but without the `@@` prefix required in the source HTML.
   >
   > `id="introductionHeader"` 是[自定义 ID][AioGuideI18nOptionalManageMarkedText]，但没有源 HTML 中所需的 `@@` 前缀。
   >
1. Duplicate the `<source>...</source>` element in the text node, rename it to `target`, and then replace its content with the French text:

   复制文本节点中的 `<source>...</source>` 元素，将其重命名为 `target` ，然后将其内容替换为法语文本：

   > <code-example path="i18n/doc-files/messages.fr.xlf.html" region="translated-hello" header="src/locale/messages.fr.xlf (trans-unit, after translation)"></code-example>
   >
   > In a more complex translation, the information and context in the [description and meaning elements][AioGuideI18nCommonPrepareAddHelpfulDescriptionsAndMeanings] described previously would help you choose the right words for translation.
   >
   > 在更复杂的翻译中，前面讲过的[描述和含义元素][AioGuideI18nCommonPrepareAddHelpfulDescriptionsAndMeanings]中的信息和上下文将帮助你选择正确的词进行翻译。
   >
1. Translate the other text nodes.
   The following example displays the way to translate.

   翻译其他文本节点。以下示例展示了翻译方式。

   > <code-example path="i18n/doc-files/messages.fr.xlf.html" region="translated-other-nodes" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

   <div class="alert is-important">

   Don't change the IDs for translation units.
   Each `id` is generated by Angular and depends on the content of the template text and its assigned meaning.
   If you change either the text or the meaning, then the `id` changes.
   For more about managing text updates and IDs, see [custom IDs][AioGuideI18nOptionalManageMarkedText].

   不要更改翻译单元的 ID。每个 `id` 由 Angular 生成并取决于模板文本的内容及其分配的含义。如果你更改文本或含义，则 `id` 也会更改。有关管理文本更新和 ID 的更多信息，请参阅 [自定义 ID][AioGuideI18nOptionalManageMarkedText]。

   </div>

### Translate plurals and alternate expressions

### 翻译复数和替代表达式

{@a translate-plural-select}

The [`plural` and `select` ICU expressions][AioGuideI18nCommonPrepareMarkPluralsAndAlternatesForTranslation] are extracted as additional messages, so you must translate them separately.

[`plural` 和 `select` ICU 表达式][AioGuideI18nCommonPrepareMarkPluralsAndAlternatesForTranslation]都被提取成了附加消息，因此你必须单独翻译它们。

#### Translate plurals

#### 翻译复数

{@a translate-plural}

To translate a `plural`, translate the ICU format match values.

要翻译 `plural` ，请翻译 ICU 格式的匹配值。

* `just now`
* `one minute ago`
* `<x id="INTERPOLATION" equiv-text="{{minutes}}"/> minutes ago`

The following example displays the way to translate.

以下示例展示了翻译方式。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translated-plural" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

Add or remove plural cases as needed for each language.

根据需要为每种语言添加或删除多个案例。

<div class="alert is-helpful">

For language plural rules, see [CLDR plural rules][GithubUnicodeOrgCldrStagingChartsLatestSupplementalLanguagePluralRulesHtml].

对于语言复数规则，请参阅 [CLDR 复数规则][GithubUnicodeOrgCldrStagingChartsLatestSupplementalLanguagePluralRulesHtml]。

</div>

#### Translate alternate expressions

#### 翻译替代表达式

{@a translate-select}

Angular also extracts alternate `select` ICU expressions as separate translation units.
The following example displays a `select` ICU expression in the component template.

Angular 还提取备用的 `select` ICU 表达式作为单独的翻译单元。以下示例在组件模板中显示了一个 `select` ICU 表达式。

<code-example path="i18n/src/app/app.component.html" region="i18n-select" header="src/app/app.component.html"></code-example>

In this example, Angular extracts the expression into two translation units.
The first contains the text outside of the `select` clause, and uses a placeholder for `select` (`<x id="ICU">`):

在这个例子中，Angular 将表达式提取到两个翻译单元中。第一个包含 `select` 子句之外的文本，并为 `select` 使用占位符（ `<x id="ICU">` ）：

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translate-select-1" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

<div class="alert is-important">

When you translate the text, move the placeholder if necessary, but don't remove it.
If you remove the placeholder, the ICU expression is removed from your translated application.

翻译文本时，如有必要，可以移动占位符，但不要将其删除。如果删除占位符，将从翻译的应用程序中删除 ICU 表达式。

</div>

The following example displays the second translation unit that contains the `select` clause.

以下示例展示了包含 `select` 子句的第二个翻译单元。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translate-select-2" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

The following example displays both translation units after translation is complete.

以下示例在翻译完成后显示两个翻译单元。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translated-select" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

#### Translate nested expressions

#### 翻译嵌套表达式

{@a translate-nested}

Angular treats a nested expression in the same manner as an alternate expression.  Angular extracts the expression into two translation units. 
The following example displays the first translation unit that contains the text outside of the nested expression.

Angular 处理嵌套表达式的方式和替代表达式一样。 Angular 会将表达式提取到两个翻译单元中。以下示例展示包含嵌套表达式之外的文本的第一个翻译单元。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translate-nested-1" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

The following example displays the second translation unit that contains the complete nested expression.

以下示例展示包含完整嵌套表达式的第二个翻译单元。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translate-nested-2" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

The following example displays both translation units after translating.

以下示例在翻译后会显示两个翻译单元。

<code-example path="i18n/doc-files/messages.fr.xlf.html" region="translate-nested" header="src/locale/messages.fr.xlf (trans-unit)"></code-example>

<!-- links -->

[AioGuideI18nOptionalManageMarkedText]: guide/i18n-optional-manage-marked-text "Manage marked text with custom IDs | Angular"

[AioGuideI18nCommonPrepareAddHelpfulDescriptionsAndMeanings]: guide/i18n-common-prepare#add-helpful-descriptions-and-meanings "Add helpful descriptions and meanings - Common Internationalization task #4: Prepare templates for translations | Angular"

[AioGuideI18nCommonPrepareMarkPluralsAndAlternatesForTranslation]: guide/i18n-common-prepare#mark-plurals-and-alternates-for-translation "Mark plurals and alternates for translation - Common Internationalization task #4: Prepare templates for translations | Angular"

[AioGuideI18nCommonTranslationFilesCreateATranslationFileForEachLanguage]: guide/i18n-common-translation-files#create-a-translation-file-for-each-language "Create a translation file for each language - Work with translation files | Angular"

[AioGuideI18nCommonTranslationFilesExtractTheSourceLanguageFile]: guide/i18n-common-translation-files#extract-the-source-language-file "Extract the source language file - Work with translation files | Angular"

[AioGuideI18nCommonTranslationFilesTranslateEachTranslationFile]: guide/i18n-common-translation-files#translate-each-translation-file "Translate each translation file - Work with translation files | Angular"

[AioGuideI18nCommonTranslationFilesTranslatePluralsAndAlternateExpressions]: guide/i18n-common-translation-files#translate-plurals-and-alternate-expressions "Translate plurals and alternate expressions - Work with translation files | Angular"

[AioCliExtractI18n]: cli/extract-i18n "ng extract-i18n | CLI | Angular"

[AioGuideWorkspaceConfig]: guide/workspace-config "Angular workspace configuration | Angular"

<!-- external links -->

[GithubGoogleAppResourceBundleWikiApplicationresourcebundlespecification]: https://github.com/google/app-resource-bundle/wiki/ApplicationResourceBundleSpecification "ApplicationResourceBundleSpecification | google/app-resource-bundle | GitHub"

[GithubUnicodeOrgCldrStagingChartsLatestSupplementalLanguagePluralRulesHtml]: https://unicode-org.github.io/cldr-staging/charts/latest/supplemental/language_plural_rules.html "Language Plural Rules - CLDR Charts | Unicode | GitHub"

[UnicodeCldrDevelopmentDevelopmentProcessDesignProposalsXmb]: http://cldr.unicode.org/development/development-process/design-proposals/xmb "XMB | CLDR - Unicode Common Locale Data Repository | Unicode"

[WikipediaWikiXliff]: https://en.wikipedia.org/wiki/XLIFF "XLIFF | Wikipedia"

<!-- end links -->

@reviewed 2021-09-15
